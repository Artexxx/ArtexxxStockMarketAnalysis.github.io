### [Drag & Drop - File Upload](https://artexxx.github.io/Case/Drag%20&%20Drop%20-%20File%20Upload/)
```text
├── index.html
├── script.js
└── style.css
```

### [[JS] Bottomless Lorem Ipsum Generator](https://artexxx.github.io/Case/%5BJS%5D%20Bottomless%20Lorem%20Ipsum%20Generator/)
```text
├── index.html
├── script.js
└── style.css
```

### [[JS+json] Hentai Dynamic Gallery](https://artexxx.github.io/Case/%5BJS+json%5D%20Hentai%20Dynamic%20Gallery/dynamic.html)
```text
├── static.html with css/js
└── dynamic.html with css/js 
```

### [[CSS] Horror Project 1Page](https://artexxx.github.io/Case/%5BCSS%5D%20Horror%20Project/)
```text
├── index.html
└── style.css
```

### [[HTML] Renton Tribute 1Page](https://artexxx.github.io/Case/%5BHTML%5D%20Renton%20Tribute%201Page/)
```text
├── index.html
└── style.css
```

### [[CSS] Dynamic Header - 1](https://artexxx.github.io/Case/%5BCSS%5D%20Dynamic%20Header%20-%201/) 
```text
├── index.html with js
└── style.css
```

### [[CSS] root element Parallax technique](https://artexxx.github.io/Case/%5BCSS%5D%20True%20Parallax%20Scrolling%20Effect/index.html)
```text
├── image
│   ├── pexels-photo-1.webp ...
│   └── ... pexels-photo-5.webp
├── index.html 
├── script.js 
└── style.css
```
### [[CSS] Cloud Banner Parallax Effects](https://artexxx.github.io/Case/%5BCSS%5D%20Cloud%20Banner%20Parallax%20Effects/index.html)
```text
├── \image with 5 images
├── index.html with js
└── style.css
```

### [[CSS] Parallax scene with CSS variables](https://artexxx.github.io/Case/%5BCSS%5D%20Parallax%20scene%20with%20CSS%20variables/)
```text
├── index.html  with img
├── script.js 
└── style.css
```

### [[CSS] Parallax Background Images + scroll buttons](https://artexxx.github.io/Case/%5BCSS%5D%20Parallax%20Background%20Images%20+%20scroll%20button/index.html) 
```text
├── index.html  with img
├── script.js 
└── style.css
```

### [[CSS] Parallax scrolling background](https://artexxx.github.io/Case/%5BCSS%5D%20Parallax%20scrolling%20background/)
```text
├── index.html with js
└── style.css
```

### [[CSS] Simple Fade Effect on Scroll](https://artexxx.github.io/Case/%5BCSS%5D%20Simple%20Fade%20Effect%20on%20Scroll/index.html)
```text
├── index.html with js
└── style.css
```

### [[CSS] Easy Button - 1](https://artexxx.github.io/Case/%5BCSS%5D%20Easy%20Button%20-%201/)
```text
├── index.html
└── style.css
```

### [[CSS] Easy Icons - 1](https://artexxx.github.io/Case/%5BCSS%5D%20Easy%20Icons%20-%201/)
```text
├── index.html
└── style.css
```

### [[CSS] Drop Capital ::first-letter](https://artexxx.github.io/Case/[CSS]%20Drop%20capital%20first%20letter/)
```text
└── index.html
```

### [[CSS] Item Check List](https://artexxx.github.io/Case/%5BCSS%5D%20Item%20Check%20List/)
```text
├── index.html
└── style.css
```

### [[CSS] Simple Table](https://artexxx.github.io/Case/%5BCSS%5D%20Simple%20Table/)
```text
├── index.html
└── style.css
```

### [[Skeleton+JS] Meal Recipe Generator](https://artexxx.github.io/%5BSkeleton+JS%5D%20Meal%20Recipe%20Generator/)
```text
├── index.html
├── script.js
└── style.css
```

### [[JS] Mood Calendar](https://artexxx.github.io/%5BJS%5D%20Mood%20Calendar/)
```text
├── index.html
├── script.js
└── style.css
```

### [[CSS+js] dark mode - 1](https://artexxx.github.io/Case/[CSS+js]%20dark%20mode%20-%201/)
```text
├── images
│   └── anime.jpg
├── script.js
├── style.css
└── index.html
```

### [[CSS+js] dark mode - 2](https://artexxx.github.io/Case/[CSS+js]%20dark%20mode%20-%202/)
```text
├── images
│   └── anime.jpg
├── script.js
├── style.css
└── index.html
```

### [WatsApp style ScareApp](https://artexxx.github.io/WatsApp%20style%20ScareApp/)
```text
├── about.html
├── favicon.ico
├── icon.ico
├── index.html
├── main.css
├── more.html
├── img
│   ├── annie96.jpg
│   ├── ...
│   └── the_thing.jpg
└── stories
    ├── annie96
    │   └── index.html
    ├── bg.png
    ├── identical
    │   ├── index.html
    │   ├── selfie1.png
    │   └── selfie2.png
    ├── joralemon
    │   ├── corridor1.jpg
    │   ├── index.html
    │   └── vault.jpg
    ├── lost
    │   └── index.html
    ├── mystery_letter
    │   └── index.html
    ├── style.css
    ├── the_picture
    │   └── index.html
    ├── the_sickness
    │   └── index.html
    └── the_thing
        └── index.html

```

### [Personal Website](https://artexxx.github.io/Personal%20Website/)
```text
├── css
│   └── style.css
├── img
│   ├── 0.svg
│   ├── 1.svg
│   ├── 2.svg
│   ├── about.jpg
│   ├── clients
│   │   └── TODO.png
│   ├── favicon.png
│   ├── intro-carousel
│   │   ├── banner-bg.jpg
│   │   └── banner-bg.png
│   ├── portfolio
│   │   └── TODO.png
│   └── preloader.gif
├── js
│   └── main.js
├── lib
│   ├── animate
│   │   ├── animate.css
│   │   └── animate.min.css
│   ├── bootstrap
│   │   ├── css
│   │   │   ├── bootstrap.css
│   │   │   └── bootstrap.min.css
│   │   └── js
│   │       ├── bootstrap.bundle.min.js
│   │       └── bootstrap.min.js
│   ├── css
│   │   └── flexslider.css
│   ├── easing
│   │   ├── easing.js
│   │   └── easing.min.js
│   ├── font-awesome
│   │   ├── css
│   │   │   ├── font-awesome.css
│   │   │   └── font-awesome.min.css
│   │   └── fonts
│   │       ├── FontAwesome.otf
│   │       ├── fontawesome-webfont.eot
│   │       ├── fontawesome-webfont.svg
│   │       ├── fontawesome-webfont.ttf
│   │       ├── fontawesome-webfont.woff
│   │       └── fontawesome-webfont.woff2
│   ├── ionicons
│   │   ├── css
│   │   │   ├── ionicons.css
│   │   │   └── ionicons.min.css
│   │   └── fonts
│   │       ├── ionicons.eot
│   │       ├── ionicons.svg
│   │       ├── ionicons.ttf
│   │       └── ionicons.woff
│   ├── jquery
│   │   ├── jquery-migrate.min.js
│   │   └── jquery.min.js
│   ├── magnific-popup
│   │   ├── magnific-popup2.css
│   │   ├── magnific-popup.js
│   │   └── magnific-popup.min.js
│   ├── owlcarousel
│   │   ├── assets
│   │   │   ├── ajax-loader.gif
│   │   │   ├── owl.carousel.css
│   │   │   ├── owl.carousel.min.css
│   │   │   ├── owl.theme.default.css
│   │   │   ├── owl.theme.default.min.css
│   │   │   ├── owl.theme.green.css
│   │   │   ├── owl.theme.green.min.css
│   │   │   └── owl.video.play.png
│   │   ├── LICENSE
│   │   ├── owl.carousel.js
│   │   ├── owl.carousel.min.js
│   │   └── README.md
│   ├── sticky
│   │   └── sticky.js
│   ├── superfish
│   │   ├── hoverIntent.js
│   │   ├── superfish.js
│   │   └── superfish.min.js
│   └── wow
│       ├── wow.js
│       └── wow.min.js
├── oops.html
├── portfolio.html
├── about.html
├── contact.html
├── services.html
├── index.html
└── solutions.html
```

### [DownGit](https://github.com/Artexxx/Artexxx.github.io/tree/master/DownGit)
```text
├── app
│   ├── app.js
│   ├── home
│   │   ├── down-git.js
│   │   ├── home.html
│   │   └── home.js
│   └── site.css
├── lib
│   ├── angular-toastr(2.0.0).min.css
│   ├── angular-toastr(2.0.0).tpls.min.js
│   └── filesaver.min.js
└── res
    └── images
        ├── downgit.png
        ├── processing.gif
        └── warning.png
├── index.html
├── README.md

```

### [Stock Market Analysis](https://artexxx.github.io/Stock%20Market%20Analysis/)
```text
├── comparison.html
├── Components
│   ├── AAPL.csv
│   ├── AXP.csv
│   ├── ... all ...
│   ├── WMT.csv
│   └── XOM.csv
├── Create APIs for Data
│   ├── app.py
│   └── data.json
├── Images
│   ├── favicon-16x16.png
│   ├── icon_big.png
│   ├── icon_small.png
│   └── README_plots
│       ├── Dj_line.png
│       └── Dj_ohlc.png
├── Load into DB
│   ├── app.py
│   └── load.ipynb
├── Resources
│   └── Components.csv
├── static
│   ├── css
│   │   ├── reset.css
│   │   └── styles.css
│   └── js
│       ├── chart.js
│       ├── comparison.js
│       └── table.js
└── StockVisualizations
    ├── index.html
    └── static
        └── js
            ├── app1.js
            ├── app.js
            ├── index.js
            ├── oldversions
            │   ├── app2.js
            │   ├── app.js
            │   └── app.js.js
            └── Untitled-1.js
├── components.html
├── contact.html
├── navbar.html
├── README.md
├── reference.html
├── index.html
```


### [Twitter-Trending](https://artexxx.github.io/Twitter-Trending/)
```text
├── all-trends.html
├── assets
│   ├── css
│   │   ├── bootstrap.css
│   │   ├── bootstrap.css.map
│   │   ├── bootstrap.min.css
│   │   ├── bootstrap-theme.css
│   │   ├── bootstrap-theme.css.map
│   │   ├── bootstrap-theme.min.css
│   │   └── chart.css
│   ├── fonts
│   │   ├── glyphicons-halflings-regular.eot
│   │   ├── glyphicons-halflings-regular.svg
│   │   ├── glyphicons-halflings-regular.ttf
│   │   └── glyphicons-halflings-regular.woff
│   ├── img
│   │   └── Twitter-180x180.png
│   ├── js-lib
│   │   ├── bootstrap.js
│   │   ├── bootstrap.min.js
│   │   └── chart.js
│   ├── jumbotron-narrow.css
│   └── navbar.css
├── contact.html
├── getjsonchart.js
├── getjson.js
├── graphic-trends.html
├── index.html
└── twitter.json
```

### [[REACT] JavaScript Array & Object Methods](https://artexxx.github.io/%5BREACT%5D%20JavaScript%20Array%20&%20Object%20Methods/)
```text
├── index.html
├── script.js
└── style.css
```


---
title: Бинарное возведение в степень
authors:
- Сергей Слотин
- Максим Иванов
weight: -10
---

*Бинарное возведение в степень* — приём, позволяющий возводить любое число в $n$-ую степень за $O(\log n)$ умножений (вместо $n$ умножений при обычном подходе).

## Основная идея

Заметим, что для любого числа $a$ и *чётного* числа $n$ выполняется тождество:

$$
a^n = (a^{n/2})^2 = a^{n/2} \cdot a^{n/2}
$$

Получается, что для любого чётного $n$ мы можем свести задачу к вдвое меньшей ($n' = \frac{n}{2}$), потратив всего одну операцию умножения.

Если же $n$ *нечётно*, то верно следующее:

$$
a^n = a^{n-1} \cdot a 
$$

Получается, для нечетных $n$ мы можем сделать сведение к задаче размера $(n-1)$, которая уже будет чётной.

Мы фактически нашли рекуррентную формулу для подсчета $a^n$:

$$
a^n = f(a, n) = \begin{cases}
   1,               && n = 0
\\ f(a, \frac{n}{2})^2,     && 2 \mid n
\\ f(a, n - 1) \cdot a, && 2 \nmid n
\end{cases}
$$

Так как каждые два перехода $n$ гарантированно уменьшается хотя бы в два раза, всего будет не более $2 \cdot \log_2 n$ переходов, прежде чем мы придём к $n = 0$. Каждый переход требует ровно одно умножение, и таким образом, мы получили алгоритм, работающий за $O(\log n)$ умножений.

## Реализация

Сразу напрашивается рекурсивная реализация этого алгоритма:

```cpp
int binpow(int a, int n) {
    if (n == 0)
        return 1;
    if (n % 2 == 1)
        return binpow(a, n - 1) * a;
    else {
        int b = binpow(a, n / 2);
        return b * b;
    }
}
```

Эта реализация рекурсивная, что работает долго. Попробуем «развернуть» рекурсию и получить итеративную.

Рассмотрим двоичное представление числа $n$. Результат $a^n$ можно представить как произведение $a$ в степенях каких-то степеней двоек. Например, если $n = 42 = 32 + 8 + 2$, то

$$
a^{42} = a^{32+8+2} = a^{32} \cdot a^8 \cdot a^2 
$$

Чтобы посчитать это произведение итеративно, пройдемся по всем битам числа $n$, поддерживая две переменные: непосредственно результат и текущее значение $a^{2^k}$, где $k$ это номер текущей итерации. На каждом шаге будем домножать $a^{2^k}$ на текущий результат, если $k$-тый бит числа $n$ единичный, и в любом случае возводить её в квадрат, получая $a^{2^k \cdot 2} = a^{2^{k+1}}$ для следующей итерации.

```cpp
int binpow(int a, int n) {
    int res = 1;
    while (n != 0) {
        if (n & 1)
            res = res * a;
        a = a * a;
        n >>= 1;
    }
    return res;
}
```

Стоит отметить, что во многих языках программирования бинарное возведение в степень уже реализовано. Но не в C++: функция `pow` из стандартной библиотеки реализована только для действительных чисел и использует приближенные методы, и поэтому не дает точных результатов для целочисленных аргументов.

## Обобщения

Бинарное возведение в степень применимо не только к умножению чисел, а вообще к любым *ассоциативным* операциям — таким, для любых $a$, $b$ и $c$ выполняется:

$$
(a \circ b) \circ c = a \circ (b \circ c) 
$$

Наиболее очевидное обобщение — на [остатки по модулю](/cs/modular):

```cpp
const int mod = 1e9 + 7;

long long binpow(long long a, int n) {
    long long  res = 1;
    while (n != 0) {
        if (n & 1)
            res = res * a % mod;
        a = a * a % mod;
        n >>= 1;
    }
    return res;
}
```

Вторым самым «популярным» обобщением является произведение матриц, про которое мы подробнее поговорим в [следующей статье](../matrix).

### Геометрические прогрессии

Возводить какие-то объекты в степень часто нужно в контексте комбинаторики, и помимо этого, иногда требуется считать суммы подобного вида:

$$
S = 1 + a + a^2 + \ldots a^{n-1}
$$

В простом случае это сумма геометрической прогрессии, и алгебраически она равна $\frac{1-a^n}{1-a}$, так что можно просто посчитать $a^n$ бинарным возведением в степень, а затем провести деление $(1-a^n)$ на $(1-a)$. Однако в общем случае так сделать нельзя — например, хотя бы потому, что [не по всем модулям](/cs/modular/reciprocal) будет существовать обратное. Поэтому бинарное возведение в степень для таких формул нужно несколько модифицировать:

$$
\begin{aligned}
f(a, n)  &= 1 + a + a^2 + \ldots a^{n-1}
\\ &= (1 + a + \ldots + a^{n/2}) + a^{n/2} \cdot (1 + a + \ldots a^{n/2})
\\ &= (1 + a^{n/2}) \cdot f(a, n)
\end{aligned}
$$

В самом алгоритме нужно помимо степеней $a$ поддерживать ещё и суммы всех степеней от $1$ до $a^k$.